# ğŸ” ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ½Ğ° Ğ±Ğ°Ğ·Ğµ JWT Ñ Ğ°ÑĞ¸Ğ¼Ğ¼ĞµÑ‚Ñ€Ğ¸Ñ‡Ğ½Ñ‹Ğ¼ ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ RS256.

---

## ğŸ“‹ Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ

- [ĞĞ±Ğ·Ğ¾Ñ€](#Ğ¾Ğ±Ğ·Ğ¾Ñ€)
- [RS256 vs HS256](#rs256-vs-hs256)
- [ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°](#Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°)
- [Middleware](#middleware)
- [ĞœÑƒĞ»ÑŒÑ‚Ğ¸Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ](#Ğ¼ÑƒĞ»ÑŒÑ‚Ğ¸Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ)
- [Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ¿Ğ¾Ğ´Ğ´ĞµĞ»ĞºĞ¸](#Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ°-Ğ¾Ñ‚-Ğ¿Ğ¾Ğ´Ğ´ĞµĞ»ĞºĞ¸)
- [ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑÑ‹](#Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑÑ‹)
- [Ğ¢Ğ¾ĞºĞµĞ½Ñ‹](#Ñ‚Ğ¾ĞºĞµĞ½Ñ‹)
- [Ğ¡ĞµÑÑĞ¸Ğ¸](#ÑĞµÑÑĞ¸Ğ¸)

---

## ĞĞ±Ğ·Ğ¾Ñ€

Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ° Ğ½Ğ° JWT (JSON Web Tokens) Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ Ğ°ÑĞ¸Ğ¼Ğ¼ĞµÑ‚Ñ€Ğ¸Ñ‡Ğ½Ğ¾Ğ³Ğ¾ ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ RS256.

### ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸

- âœ… **RS256** - Ğ°ÑĞ¸Ğ¼Ğ¼ĞµÑ‚Ñ€Ğ¸Ñ‡Ğ½Ğ¾Ğµ ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹ + Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡)
- âœ… **Access Token + Refresh Token** - Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞµÑÑĞ¸Ğ¹
- âœ… **ĞœÑƒĞ»ÑŒÑ‚Ğ¸Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ** - Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²Ğ¾ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾
- âœ… **Middleware** - Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²
- âœ… **Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ¿Ğ¾Ğ´Ğ´ĞµĞ»ĞºĞ¸** - Ğ½ĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾ĞºĞµĞ½ Ğ±ĞµĞ· Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ»ÑÑ‡Ğ°
- âœ… **Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ğº Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼** - Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ñ€Ğ°ÑĞ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ°Ğ½ÑÑ‚ÑŒ

---

## RS256 vs HS256 | Production


### ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ RS256?

#### 1. Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

**RS256:**
```
ĞŸÑ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡ (ÑĞµĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹)  â†’ ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑÑŒ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²
ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡ (Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¹)   â†’ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²

ĞšĞ¾Ğ¼Ğ¿Ñ€Ğ¾Ğ¼ĞµÑ‚Ğ°Ñ†Ğ¸Ñ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ»ÑÑ‡Ğ° â†’ ĞĞµ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾
```

**HS256:**
```
ĞĞ±Ñ‰Ğ¸Ğ¹ ĞºĞ»ÑÑ‡ (ÑĞµĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹) â†’ ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑÑŒ Ğ˜ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ°

ĞšĞ¾Ğ¼Ğ¿Ñ€Ğ¾Ğ¼ĞµÑ‚Ğ°Ñ†Ğ¸Ñ ĞºĞ»ÑÑ‡Ğ° â†’ ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº ÑĞ¸ÑÑ‚ĞµĞ¼Ğµ
```

#### 2. ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑÑ‹

**RS256:**
```
Auth Service (Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡)
    â†“ Ğ²Ñ‹Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ Ñ‚Ğ¾ĞºĞµĞ½Ñ‹
User â†’ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ JWT Ñ‚Ğ¾ĞºĞµĞ½
    â†“ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹
Analytics Service (Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡) â†’ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ñ‚Ğ¾ĞºĞµĞ½ âœ…
Finance Service (Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡)   â†’ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ñ‚Ğ¾ĞºĞµĞ½ âœ…
Reports Service (Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡)   â†’ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ñ‚Ğ¾ĞºĞµĞ½ âœ…
```

**HS256:**
```
Auth Service (Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ ĞºĞ»ÑÑ‡)
    â†“ Ğ²Ñ‹Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ Ñ‚Ğ¾ĞºĞµĞ½Ñ‹
User â†’ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ JWT Ñ‚Ğ¾ĞºĞµĞ½
    â†“ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹
Analytics Service (Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ ĞºĞ»ÑÑ‡) â†’ Ğ¼Ğ¾Ğ¶ĞµÑ‚ ĞŸĞĞ”ĞŸĞ˜Ğ¡Ğ«Ğ’ĞĞ¢Ğ¬ Ñ‚Ğ¾ĞºĞµĞ½Ñ‹ âŒ
Finance Service (Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ ĞºĞ»ÑÑ‡)   â†’ Ğ¼Ğ¾Ğ¶ĞµÑ‚ ĞŸĞĞ”ĞŸĞ˜Ğ¡Ğ«Ğ’ĞĞ¢Ğ¬ Ñ‚Ğ¾ĞºĞµĞ½Ñ‹ âŒ
Reports Service (Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ ĞºĞ»ÑÑ‡)   â†’ Ğ¼Ğ¾Ğ¶ĞµÑ‚ ĞŸĞĞ”ĞŸĞ˜Ğ¡Ğ«Ğ’ĞĞ¢Ğ¬ Ñ‚Ğ¾ĞºĞµĞ½Ñ‹ âŒ
```

Ğ¡ HS256 ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑĞµÑ€Ğ²Ğ¸Ñ Ğ¼Ğ¾Ğ¶ĞµÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ñ‚Ğ¾ĞºĞµĞ½Ñ‹, Ñ‡Ñ‚Ğ¾ Ğ½ĞµĞ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾!

#### 3. Ğ Ğ°ÑĞ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ ĞºĞ»ÑÑ‡ĞµĞ¹

**RS256:**
- ĞŸÑ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡ â†’ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ° Auth Service
- ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡ â†’ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ Ñ€Ğ°ÑĞ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ°Ğ½ÑÑ‚ÑŒ
- ĞšĞ¾Ğ¼Ğ¿Ñ€Ğ¾Ğ¼ĞµÑ‚Ğ°Ñ†Ğ¸Ñ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ»ÑÑ‡Ğ° â†’ Ğ½Ğµ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ°

**HS256:**
- ĞĞ±Ñ‰Ğ¸Ğ¹ ĞºĞ»ÑÑ‡ â†’ Ğ½Ğ° Ğ²ÑĞµÑ… ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ñ…
- ĞšĞ¾Ğ¼Ğ¿Ñ€Ğ¾Ğ¼ĞµÑ‚Ğ°Ñ†Ğ¸Ñ ĞºĞ»ÑÑ‡Ğ° â†’ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¼ĞµĞ½ÑÑ‚ÑŒ Ğ²ĞµĞ·Ğ´Ğµ
- Ğ£Ñ‚ĞµÑ‡ĞºĞ° ĞºĞ»ÑÑ‡Ğ° â†’ Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ¿Ñ€Ğ¾Ğ¼ĞµÑ‚Ğ°Ñ†Ğ¸Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

---

## ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

### ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT                              â”‚
â”‚  (Browser, Mobile App, Postman)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MIDDLEWARE                             â”‚
â”‚  - Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµÑ‚ Ñ‚Ğ¾ĞºĞµĞ½ Ğ¸Ğ· cookies                               â”‚
â”‚  - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ (Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡)                       â”‚
â”‚  - Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ                            â”‚
â”‚  - Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ² request.state                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â†“                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PUBLIC ENDPOINTS    â”‚   â”‚  PROTECTED ENDPOINTS  â”‚
â”‚  /public/register     â”‚   â”‚  /users/me            â”‚
â”‚  /public/login        â”‚   â”‚  /analytics/*         â”‚
â”‚  /public/healthcheck  â”‚   â”‚  /finance/*           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  /admin/*             â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â†“
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ PERMISSIONS DECORATOR â”‚
                            â”‚ @require_permission   â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

#### Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ

```
1. POST /api/v1/public/users/register
   {
     "email": "user@example.com",
     "passw": "SecurePass123!",
     ...
   }
   
2. Ğ¥ĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ (Argon2)
   passw_hash = argon2.hash("SecurePass123!")
   
3. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² Ğ‘Ğ”
   INSERT INTO users (email, passw, ...)
   
4. ĞÑ‚Ğ²ĞµÑ‚
   {
     "id": 1,
     "email": "user@example.com"
   }
```

#### Ğ’Ñ…Ğ¾Ğ´

```
1. POST /api/v1/public/users/login
   {
     "email": "user@example.com",
     "passw": "SecurePass123!"
   }
   
2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ
   SELECT * FROM users WHERE email = 'user@example.com'
   argon2.verify("SecurePass123!", passw_hash)
   
3. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²
   access_token = JWT.encode({
     "id": 1,
     "role": "admin",
     "exp": now + 15min
   }, private_key, algorithm="RS256")
   
   refresh_token = JWT.encode({
     "id": 1,
     "exp": now + 30days
   }, private_key, algorithm="RS256")
   
4. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ ÑĞµÑÑĞ¸Ğ¸
   INSERT INTO sessions (user_id, refresh_token, user_agent, ip, ...)
   
5. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° cookies
   Set-Cookie: access_token=...; HttpOnly; Secure; SameSite=Strict
   Set-Cookie: refresh_token=...; HttpOnly; Secure; SameSite=Strict
```

#### Ğ—Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ

```
1. GET /api/v1/users/me
   Cookie: access_token=eyJhbGc...
   
2. Middleware Ğ¸Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµÑ‚ Ñ‚Ğ¾ĞºĞµĞ½
   token = request.cookies.get("access_token")
   
3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸
   payload = JWT.decode(token, public_key, algorithms=["RS256"])
   
4. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² request
   request.state.user_id = payload["id"]
   request.state.role = payload["role"]
   
5. Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ ÑĞ½Ğ´Ğ¿Ğ¾Ğ¸Ğ½Ñ‚Ğ°
   user = await db.users.select_user_by_id(request.state.user_id)
   return user
```

#### ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¾ĞºĞµĞ½Ğ°

```
1. POST /api/v1/public/users/refresh
   Cookie: refresh_token=eyJhbGc...
   
2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° refresh_token
   payload = JWT.decode(refresh_token, public_key)
   
3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑĞµÑÑĞ¸Ğ¸ Ğ² Ğ‘Ğ”
   session = SELECT * FROM sessions WHERE refresh_token = '...'
   
4. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ access_token
   new_access_token = JWT.encode({...}, private_key)
   
5. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ cookie
   Set-Cookie: access_token=...; HttpOnly; Secure
```

---

## Middleware

### Ğ—Ğ°Ñ‡ĞµĞ¼ middleware?

**Ğ‘ĞµĞ· middleware:**
```python
@router.get('/users/me')
async def get_me(request: Request):
    # Ğ”ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ´Ğ° Ğ² ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ ÑĞ½Ğ´Ğ¿Ğ¾Ğ¸Ğ½Ñ‚Ğµ
    token = request.cookies.get("access_token")
    if not token:
        raise HTTPException(401)
    
    try:
        payload = jwt.decode(token, public_key)
    except:
        raise HTTPException(401)
    
    user_id = payload["id"]
    # ... Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° ÑĞ½Ğ´Ğ¿Ğ¾Ğ¸Ğ½Ñ‚Ğ°
```

**Ğ¡ middleware:**
```python
@router.get('/users/me')
async def get_me(request: Request):
    # Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ÑƒĞ¶Ğµ Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ñ‹ middleware
    user_id = request.state.user_id
    role = request.state.role
    # ... Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° ÑĞ½Ğ´Ğ¿Ğ¾Ğ¸Ğ½Ñ‚Ğ°
```

### Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

```python
# core/api/middleware.py

async def jwt_middleware(request: Request, call_next):
    # ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğµ ÑĞ½Ğ´Ğ¿Ğ¾Ğ¸Ğ½Ñ‚Ñ‹ - Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼
    if request.url.path.startswith('/api/v1/public/'):
        return await call_next(request)
    
    # Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµĞ¼ Ñ‚Ğ¾ĞºĞµĞ½
    token = request.cookies.get('access_token')
    if not token:
        raise HTTPException(401, "Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ")
    
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ
    try:
        payload = jwt.decode(
            token,
            public_key,
            algorithms=["RS256"]
        )
    except jwt.ExpiredSignatureError:
        raise HTTPException(401, "Ğ¢Ğ¾ĞºĞµĞ½ Ğ¸ÑÑ‚ĞµĞº")
    except jwt.InvalidTokenError:
        raise HTTPException(401, "ĞĞµĞ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹ Ñ‚Ğ¾ĞºĞµĞ½")
    
    # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ² request
    request.state.user_id = payload["id"]
    request.state.role = payload["role"]
    request.state.user_agent = payload["user_agent"]
    request.state.ip = payload["ip"]
    
    return await call_next(request)
```

### ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°

- âœ… **Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ** - Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ Ğ¼ĞµÑÑ‚Ğµ
- âœ… **DRY** - Ğ½ĞµÑ‚ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ĞºĞ¾Ğ´Ğ°
- âœ… **Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ** - Ğ½ĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ·Ğ°Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ
- âœ… **ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ** - Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ· Ğ½Ğ° Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
- âœ… **Ğ“Ğ¸Ğ±ĞºĞ¾ÑÑ‚ÑŒ** - Ğ»ĞµĞ³ĞºĞ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ, rate limiting

### ĞĞ´Ñ€ĞµÑĞ°Ñ†Ğ¸Ñ ÑĞ½Ğ´Ğ¿Ğ¾Ğ¸Ğ½Ñ‚Ğ¾Ğ²

```
/api/v1/
â”œâ”€â”€ public/          â† Middleware Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµÑ‚
â”‚   â”œâ”€â”€ /register
â”‚   â”œâ”€â”€ /login
â”‚   â””â”€â”€ /healthcheck
â”‚
â””â”€â”€ (Ğ²ÑĞµ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ)  â† Middleware Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ñ‚Ğ¾ĞºĞµĞ½
    â”œâ”€â”€ /users/
    â”œâ”€â”€ /analytics/
    â”œâ”€â”€ /finance/
    â””â”€â”€ /admin/
```

**ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ñ‚Ğ°ĞºĞ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°?**
- Ğ¯Ğ²Ğ½Ğ¾Ğµ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ñ… Ğ¸ Ğ·Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½Ğ½Ñ‹Ñ… ÑĞ½Ğ´Ğ¿Ğ¾Ğ¸Ğ½Ñ‚Ğ¾Ğ²
- Ğ›ĞµĞ³ĞºĞ¾ Ğ¿Ğ¾Ğ½ÑÑ‚ÑŒ ĞºĞ°ĞºĞ¸Ğµ ÑĞ½Ğ´Ğ¿Ğ¾Ğ¸Ğ½Ñ‚Ñ‹ Ñ‚Ñ€ĞµĞ±ÑƒÑÑ‚ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
- Middleware Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑ Ğ¿ÑƒÑ‚Ğ¸ (Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾)

---

## ĞœÑƒĞ»ÑŒÑ‚Ğ¸Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

### ĞšĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ğ¸Ñ

ĞĞ´Ğ¸Ğ½ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½ Ğ½Ğ° Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²Ğµ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾.

```
User: admin@example.com
â”‚
â”œâ”€â”€ Session 1
â”‚   â”œâ”€â”€ Device: Chrome (Windows)
â”‚   â”œâ”€â”€ IP: 192.168.1.100
â”‚   â”œâ”€â”€ access_token: eyJhbGc...
â”‚   â”œâ”€â”€ refresh_token: eyJhbGc...
â”‚   â””â”€â”€ expires_at: 2026-03-11
â”‚
â”œâ”€â”€ Session 2
â”‚   â”œâ”€â”€ Device: Firefox (Windows)
â”‚   â”œâ”€â”€ IP: 192.168.1.100
â”‚   â”œâ”€â”€ access_token: eyJhbGc...
â”‚   â”œâ”€â”€ refresh_token: eyJhbGc...
â”‚   â””â”€â”€ expires_at: 2026-03-11
â”‚
â””â”€â”€ Session 3
    â”œâ”€â”€ Device: Mobile (Android)
    â”œâ”€â”€ IP: 192.168.1.150
    â”œâ”€â”€ access_token: eyJhbGc...
    â”œâ”€â”€ refresh_token: eyJhbGc...
    â””â”€â”€ expires_at: 2026-03-11
```

### Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

#### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° sessions

```sql
CREATE TABLE sessions (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    refresh_token TEXT UNIQUE NOT NULL,
    user_agent TEXT,
    ip INET,
    created_at TIMESTAMP DEFAULT NOW(),
    expires_at TIMESTAMP NOT NULL
);
```

#### ĞŸÑ€Ğ¸ Ğ²Ñ…Ğ¾Ğ´Ğµ

```python
# Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ½Ğ¾Ğ²ÑƒÑ ÑĞµÑÑĞ¸Ñ (Ğ½Ğµ ÑƒĞ´Ğ°Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ)
session_id = await db.sessions.create_session(
    user_id=user.id,
    refresh_token=refresh_token,
    user_agent=request.headers.get('user-agent'),
    ip=request.state.client_ip,
    expires_at=datetime.now(UTC) + timedelta(days=30)
)
```

#### ĞŸÑ€Ğ¸ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğµ

```python
# Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚ĞµĞºÑƒÑ‰ÑƒÑ ÑĞµÑÑĞ¸Ñ
await db.sessions.delete_session(refresh_token)

# Ğ”Ñ€ÑƒĞ³Ğ¸Ğµ ÑĞµÑÑĞ¸Ğ¸ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°ÑÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ
```

#### Ğ’Ñ‹Ñ…Ğ¾Ğ´ ÑĞ¾ Ğ²ÑĞµÑ… ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²

```python
# Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ²ÑĞµ ÑĞµÑÑĞ¸Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
await db.sessions.delete_all_user_sessions(user_id)
```

### ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°

- âœ… Ğ£Ğ´Ğ¾Ğ±ÑÑ‚Ğ²Ğ¾ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ (Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑŒ Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²)
- âœ… Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ (Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾Ñ‚Ğ¾Ğ·Ğ²Ğ°Ñ‚ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ñ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°)
- âœ… ĞÑƒĞ´Ğ¸Ñ‚ (Ğ²Ğ¸Ğ´Ğ½Ğ¾ Ñ ĞºĞ°ĞºĞ¸Ñ… ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ² Ğ·Ğ°Ñ…Ğ¾Ğ´Ğ¸Ğ» Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ)
- âœ… Ğ“Ğ¸Ğ±ĞºĞ¾ÑÑ‚ÑŒ (Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑĞµÑÑĞ¸Ğ¹)

---

## Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ¿Ğ¾Ğ´Ğ´ĞµĞ»ĞºĞ¸

### ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ cookies Ğ½Ğµ Ğ¿Ñ€Ğ¾ĞºĞ°Ñ‚Ğ¸Ñ‚?

#### Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° JWT Ñ‚Ğ¾ĞºĞµĞ½Ğ°

```
JWT = Header.Payload.Signature

Header (Base64):
{
  "alg": "RS256",
  "typ": "JWT"
}

Payload (Base64):
{
  "id": 1,
  "role": "admin",
  "exp": 1707494400
}

Signature (RS256):
RS256(Header + Payload, private_key)
```

#### ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¿Ğ¾Ğ´Ğ´ĞµĞ»ĞºĞ¸

```
1. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ñ‚Ğ¾ĞºĞµĞ½:
   eyJhbGc...  (Header)
   .
   eyJpZCI...  (Payload: {"id": 1, "role": "user"})
   .
   SflKxwR... (Signature)

2. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ´ĞµĞºĞ¾Ğ´Ğ¸Ñ€ÑƒĞµÑ‚ Payload:
   {"id": 1, "role": "user"}

3. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¸Ğ·Ğ¼ĞµĞ½ÑĞµÑ‚ Payload:
   {"id": 1, "role": "admin"}  â† Ğ¥Ğ¾Ñ‡ĞµÑ‚ ÑÑ‚Ğ°Ñ‚ÑŒ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ¼

4. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ĞºĞ¾Ğ´Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾:
   eyJpZCI... (Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Payload)

5. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ñ‚Ğ¾ĞºĞµĞ½:
   eyJhbGc...
   .
   eyJpZCI... (Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ½Ñ‹Ğ¹ Payload)
   .
   SflKxwR... (ÑÑ‚Ğ°Ñ€Ğ°Ñ Signature)

6. Middleware Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚:
   RS256_verify(
     signature=SflKxwR...,
     data=Header + Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Payload,
     public_key
   )
   
   Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚: ĞĞ•Ğ’ĞĞ›Ğ˜Ğ”ĞĞ âŒ
   
   ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°: Signature Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ°Ğ½Ğ° Ğ´Ğ»Ñ ÑÑ‚Ğ°Ñ€Ğ¾Ğ³Ğ¾ Payload
```

#### ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ğ½ĞµĞ»ÑŒĞ·Ñ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ?

```
Ğ”Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸ Ğ½ÑƒĞ¶ĞµĞ½ Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡:

Signature = RS256(Header + Payload, private_key)

ĞŸÑ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡:
- Ğ¥Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ
- ĞĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñƒ
- Ğ—Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½ Ñ‡ĞµÑ€ĞµĞ· Docker Secrets
- ĞĞµ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½ Ğ² Docker Ğ¾Ğ±Ñ€Ğ°Ğ·

Ğ‘ĞµĞ· Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ»ÑÑ‡Ğ° Ğ½ĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½ÑƒÑ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ!
```

### Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ°

#### 1. HttpOnly cookies

```python
response.set_cookie(
    key="access_token",
    value=token,
    httponly=True,  # JavaScript Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ
    secure=True,    # Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ HTTPS
    samesite="strict"  # Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ CSRF
)
```

#### 2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° user_agent Ğ¸ IP

```python
# Ğ’ Ñ‚Ğ¾ĞºĞµĞ½Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ user_agent Ğ¸ IP
payload = {
    "id": 1,
    "role": "admin",
    "user_agent": "Mozilla/5.0...",
    "ip": "192.168.1.100"
}

# ĞŸÑ€Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞµ ÑÑ€Ğ°Ğ²Ğ½Ğ¸Ğ²Ğ°ĞµĞ¼
if payload["user_agent"] != request.headers.get("user-agent"):
    raise HTTPException(401, "Ğ¢Ğ¾ĞºĞµĞ½ ÑƒĞºÑ€Ğ°Ğ´ĞµĞ½")

if payload["ip"] != request.state.client_ip:
    raise HTTPException(401, "Ğ¢Ğ¾ĞºĞµĞ½ ÑƒĞºÑ€Ğ°Ğ´ĞµĞ½")
```

#### 3. ĞšĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¹ TTL Ğ´Ğ»Ñ access_token

```python
# Access token Ğ¶Ğ¸Ğ²ĞµÑ‚ 15 Ğ¼Ğ¸Ğ½ÑƒÑ‚
access_token_ttl = timedelta(minutes=15)

# Ğ”Ğ°Ğ¶Ğµ ĞµÑĞ»Ğ¸ Ñ‚Ğ¾ĞºĞµĞ½ ÑƒĞºÑ€Ğ°Ğ´ĞµĞ½, Ğ¾Ğ½ ÑĞºĞ¾Ñ€Ğ¾ Ğ¸ÑÑ‚ĞµÑ‡ĞµÑ‚
```

#### 4. Refresh token rotation

```python
# ĞŸÑ€Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸ access_token Ğ²Ñ‹Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ refresh_token
new_refresh_token = generate_refresh_token()

# Ğ¡Ñ‚Ğ°Ñ€Ñ‹Ğ¹ refresh_token ÑƒĞ´Ğ°Ğ»ÑĞµĞ¼ Ğ¸Ğ· Ğ‘Ğ”
await db.sessions.update_refresh_token(old_token, new_refresh_token)

# Ğ•ÑĞ»Ğ¸ ĞºÑ‚Ğ¾-Ñ‚Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ ÑÑ‚Ğ°Ñ€Ñ‹Ğ¹ refresh_token â†’ Ğ¿Ğ¾Ğ´Ğ¾Ğ·Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾
```

---

## ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑÑ‹

### ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AUTH SERVICE                             â”‚
â”‚  - ĞŸÑ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡ (private_jwt.pem)                         â”‚
â”‚  - Ğ’Ñ‹Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ JWT Ñ‚Ğ¾ĞºĞµĞ½Ñ‹                                     â”‚
â”‚  - /register, /login, /refresh                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“ Ğ²Ñ‹Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ Ñ‚Ğ¾ĞºĞµĞ½Ñ‹
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER                                 â”‚
â”‚  - ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ JWT Ñ‚Ğ¾ĞºĞµĞ½                                       â”‚
â”‚  - ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ñ‚Ğ¾ĞºĞµĞ½ Ğ² ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞµ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                   â†“                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ANALYTICS    â”‚   â”‚   FINANCE     â”‚   â”‚   REPORTS     â”‚
â”‚   SERVICE     â”‚   â”‚   SERVICE     â”‚   â”‚   SERVICE     â”‚
â”‚               â”‚   â”‚               â”‚   â”‚               â”‚
â”‚ ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡â”‚   â”‚ ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡â”‚   â”‚ ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡â”‚
â”‚ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚     â”‚   â”‚ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚     â”‚   â”‚ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚     â”‚
â”‚ Ñ‚Ğ¾ĞºĞµĞ½Ñ‹        â”‚   â”‚ Ñ‚Ğ¾ĞºĞµĞ½Ñ‹        â”‚   â”‚ Ñ‚Ğ¾ĞºĞµĞ½Ñ‹        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ Ğ°ÑĞ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ»ÑÑ‡Ğ°

#### Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 1: Ğ¤Ğ°Ğ¹Ğ»

```bash
# ĞšĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡ Ğ½Ğ° ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑĞµÑ€Ğ²Ğ¸Ñ
scp public_jwt.pem analytics-service:/app/keys/
scp public_jwt.pem finance-service:/app/keys/
scp public_jwt.pem reports-service:/app/keys/
```

#### Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 2: Environment variable

```yaml
# docker-compose.yml
services:
  analytics:
    environment:
      - PUBLIC_KEY=${PUBLIC_KEY}
```

#### Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 3: Shared volume

```yaml
services:
  analytics:
    volumes:
      - ./keys/public_jwt.pem:/app/keys/public_jwt.pem:ro
  
  finance:
    volumes:
      - ./keys/public_jwt.pem:/app/keys/public_jwt.pem:ro
```

#### Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 4: Config service

```
Config Service (Consul, etcd)
    â†“ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡
Ğ¡ĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ·Ğ°Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ÑÑ‚ ĞºĞ»ÑÑ‡ Ğ¿Ñ€Ğ¸ ÑÑ‚Ğ°Ñ€Ñ‚Ğµ
```

### ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‚Ğ¾ĞºĞµĞ½Ğ° Ğ² Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞµ

```python
# analytics-service/middleware.py

import jwt
from pathlib import Path

# Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡
PUBLIC_KEY = Path('/app/keys/public_jwt.pem').read_text()

async def jwt_middleware(request: Request, call_next):
    token = request.cookies.get('access_token')
    
    try:
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ‚Ğ¾ĞºĞµĞ½ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¼ ĞºĞ»ÑÑ‡Ğ¾Ğ¼
        payload = jwt.decode(
            token,
            PUBLIC_KEY,
            algorithms=["RS256"]
        )
        
        request.state.user_id = payload["id"]
        request.state.role = payload["role"]
        
    except jwt.InvalidTokenError:
        raise HTTPException(401)
    
    return await call_next(request)
```

### ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ° RS256 Ğ´Ğ»Ñ Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²

- âœ… **Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ** - ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ½Ğµ Ğ¼Ğ¾Ğ³ÑƒÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ñ‚Ğ¾ĞºĞµĞ½Ñ‹
- âœ… **ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ñ‚Ğ°** - Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ Ñ€Ğ°ÑĞ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ°Ğ½ÑÑ‚ÑŒ
- âœ… **ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ** - Ğ»ĞµĞ³ĞºĞ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹
- âœ… **ĞĞµĞ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ** - ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ½Ğµ Ğ·Ğ°Ğ²Ğ¸ÑÑÑ‚ Ğ¾Ñ‚ Auth Service Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²

---

## Ğ¢Ğ¾ĞºĞµĞ½Ñ‹

### Access Token

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** Ğ”Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ·Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½Ğ½Ñ‹Ğ¼ Ñ€ĞµÑÑƒÑ€ÑĞ°Ğ¼

**TTL:** 15 Ğ¼Ğ¸Ğ½ÑƒÑ‚

**Payload:**
```json
{
  "id": 1,
  "role": "admin",
  "user_agent": "Mozilla/5.0...",
  "ip": "192.168.1.100",
  "exp": 1707494400
}
```

**Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ:** HttpOnly cookie

### Refresh Token

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ access_token

**TTL:** 30 Ğ´Ğ½ĞµĞ¹

**Payload:**
```json
{
  "id": 1,
  "session_id": 123,
  "exp": 1710086400
}
```

**Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ:** HttpOnly cookie + Ğ‘Ğ” (Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° sessions)

### ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ğ´Ğ²Ğ° Ñ‚Ğ¾ĞºĞµĞ½Ğ°?

- **Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ** - ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¹ TTL Ğ´Ğ»Ñ access_token
- **Ğ£Ğ´Ğ¾Ğ±ÑÑ‚Ğ²Ğ¾** - Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ²Ğ²Ğ¾Ğ´Ğ¸Ñ‚ÑŒ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 15 Ğ¼Ğ¸Ğ½ÑƒÑ‚
- **ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ** - Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾Ñ‚Ğ¾Ğ·Ğ²Ğ°Ñ‚ÑŒ refresh_token (Ğ²Ñ‹Ñ…Ğ¾Ğ´)

---

## Ğ¡ĞµÑÑĞ¸Ğ¸

### Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° sessions

```sql
CREATE TABLE sessions (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    refresh_token TEXT UNIQUE NOT NULL,
    user_agent TEXT,
    ip INET,
    created_at TIMESTAMP DEFAULT NOW(),
    expires_at TIMESTAMP NOT NULL
);

CREATE INDEX idx_sessions_user_id ON sessions(user_id);
CREATE INDEX idx_sessions_refresh_token ON sessions(refresh_token);
CREATE INDEX idx_sessions_expires_at ON sessions(expires_at);
```

### ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° Ğ¸ÑÑ‚ĞµĞºÑˆĞ¸Ñ… ÑĞµÑÑĞ¸Ğ¹

```sql
-- Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸ÑÑ‚ĞµĞºÑˆĞ¸Ñ… ÑĞµÑÑĞ¸Ğ¹ (cron job)
DELETE FROM sessions WHERE expires_at < NOW();
```

### ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ° ÑĞµÑÑĞ¸Ğ¹

```python
# ĞœĞ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 5 ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ² Ğ½Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
MAX_SESSIONS = 5

sessions_count = await db.sessions.count_user_sessions(user_id)

if sessions_count >= MAX_SESSIONS:
    # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ ÑĞ°Ğ¼ÑƒÑ ÑÑ‚Ğ°Ñ€ÑƒÑ ÑĞµÑÑĞ¸Ñ
    await db.sessions.delete_oldest_session(user_id)
```

---

## ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ

| ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ | Ğ’Ñ€ĞµĞ¼Ñ |
|----------|-------|
| Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ access_token (RS256) | ~2ms |
| ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° access_token (RS256) | ~1ms |
| Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ refresh_token (RS256) | ~2ms |
| Ğ¥ĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ (Argon2) | ~50ms |
| ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ°Ñ€Ğ¾Ğ»Ñ (Argon2) | ~50ms |

---

## Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

### Checklist

- [x] RS256 (Ğ°ÑĞ¸Ğ¼Ğ¼ĞµÑ‚Ñ€Ğ¸Ñ‡Ğ½Ğ¾Ğµ ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)
- [x] HttpOnly cookies (Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ XSS)
- [x] Secure flag (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ HTTPS)
- [x] SameSite=Strict (Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ CSRF)
- [x] ĞšĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¹ TTL Ğ´Ğ»Ñ access_token (15 Ğ¼Ğ¸Ğ½ÑƒÑ‚)
- [x] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° user_agent Ğ¸ IP
- [x] Argon2 Ğ´Ğ»Ñ Ğ¿Ğ°Ñ€Ğ¾Ğ»ĞµĞ¹
- [x] Refresh token rotation
- [x] ĞŸÑ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡ Ñ‡ĞµÑ€ĞµĞ· Docker Secrets
- [x] Rate limiting Ğ´Ğ»Ñ /login

---

## ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹

Ğ¡Ğ¼. [API Reference](API_REFERENCE.md) Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ğ¾Ğ² Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ².

---